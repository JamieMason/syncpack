---
import StarlightHead from '@astrojs/starlight/components/Head.astro';
import { buildSchemas } from '../lib/schema';

const siteUrl = 'https://syncpack.dev';

// Access the page ID from Starlight's route data
const pageId = Astro.locals.starlightRoute?.id || '';

// Use dynamic OG image for docs pages, fallback to static for FAQ pages
let ogImagePath = '/social-card.jpg';
if (pageId === '') {
  // Homepage - use index.png
  ogImagePath = '/og/index.png';
} else if (pageId && !pageId.startsWith('faq')) {
  // Other docs pages
  ogImagePath = `/syncpack/og/${pageId}.png`;
}

const fullOgUrl = `${siteUrl}${ogImagePath}`;

// Build structured data schemas for this page
const route = Astro.locals.starlightRoute;
const schemas = route ? buildSchemas(route) : [];
---

<StarlightHead {...Astro.props}>
  <slot />
</StarlightHead>

{
  schemas.map((schema) => (
    <script is:inline type="application/ld+json" set:html={JSON.stringify(schema)} />
  ))
}

<!-- Override OG images with dynamic ones -->
<meta property="og:image" content={fullOgUrl} />
<meta property="og:image:width" content="1200" />
<meta property="og:image:height" content="630" />
<meta property="og:image:type" content="image/png" />
<meta name="twitter:image" content={fullOgUrl} />
<meta name="twitter:card" content="summary_large_image" />
